import{u as _,a as P,b as A,r as a,j as e,C as E,S as I,B as T,E as k,U as F,c as q,T as D}from"./main-dBnsIpWn.js";const i="table_prefs_ctacte_items",B=()=>{const g=_();P(),A();const[m,j]=a.useState([]),[f,u]=a.useState(!0),[d,o]=a.useState(1),[N,y]=a.useState(1),[v,C]=a.useState(0),[c,x]=a.useState(()=>{const s=localStorage.getItem(i),t=parseInt(s,10);return t&&t>0?t:10}),[$,z]=a.useState({total_deuda:0,cantidad_deudores:0});a.useEffect(()=>{localStorage.getItem(i)||fetch("/api/config/obtener/").then(s=>s.json()).then(s=>{s.items_por_pagina&&x(s.items_por_pagina)}).catch(console.error)},[]);const[r,h]=a.useState({busqueda:"",estado_deuda:"todos"}),S=s=>new Intl.NumberFormat("es-AR",{style:"currency",currency:"ARS"}).format(s),p=a.useCallback(async s=>{if(c!==0){u(!0);try{const t=new URLSearchParams({page:d,per_page:c,busqueda:r.busqueda,type:"ctacte",...r}),l=await(await fetch(`/api/clientes/buscar/?${t}`,{signal:s})).json();j(l.clientes||[]),y(l.total_pages||1),C(l.total||0)}catch(t){t.name!=="AbortError"&&console.error("Error al cargar clientes:",t)}finally{u(!1)}}},[d,r,c]);a.useEffect(()=>{const s=new AbortController;return p(s.signal),()=>s.abort()},[p]);const b=s=>{const{name:t,value:n}=s.target;h(l=>({...l,[t]:n})),o(1)},w=s=>{g(`/ctas-corrientes/clientes/${s.id}`)};return e.jsxs("div",{className:"container-fluid px-4 pt-4 pb-0 bg-light fade-in main-content-container",children:[e.jsx("div",{className:"d-flex justify-content-between align-items-center mb-4",children:e.jsxs("div",{children:[e.jsxs("h2",{className:"text-primary fw-bold mb-0",style:{fontSize:"2rem"},children:[e.jsx(E,{className:"me-2 inline-block",size:32}),"Cuentas Corrientes"]}),e.jsx("p",{className:"text-muted mb-0 ps-1",style:{fontSize:"1rem"},children:"Gestión de saldos y movimientos de clientes."})]})}),e.jsx("div",{className:"card border-0 shadow-sm mb-4",children:e.jsx("div",{className:"card-body bg-light rounded",children:e.jsxs("div",{className:"row g-3",children:[e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"input-group",children:[e.jsx("span",{className:"input-group-text bg-white border-end-0",children:e.jsx(I,{size:18,className:"text-muted"})}),e.jsx("input",{type:"text",className:"form-control border-start-0",placeholder:"Buscar cliente por nombre, CUIT...",name:"busqueda",value:r.busqueda,onChange:b})]})}),e.jsx("div",{className:"col-md-3",children:e.jsxs("select",{className:"form-select",name:"estado_deuda",value:r.estado_deuda,onChange:b,children:[e.jsx("option",{value:"todos",children:"Todos los Estados"}),e.jsx("option",{value:"con_deuda",children:"Con Deuda (Saldo Mayor a $0)"}),e.jsx("option",{value:"al_dia",children:"Al Día (Saldo $0)"}),e.jsx("option",{value:"saldo_favor",children:"A Favor (Saldo Menor a $0)"})]})}),e.jsx("div",{className:"col-md-3",children:e.jsx(T,{onClick:()=>{h({busqueda:"",estado_deuda:"todos"}),o(1)},className:"w-100"})})]})})}),e.jsx("div",{className:"card border-0 shadow mb-4 flex-grow-1 overflow-hidden d-flex flex-column",children:e.jsxs("div",{className:"card-body p-0 d-flex flex-column overflow-hidden",children:[e.jsx("div",{className:"table-responsive flex-grow-1 table-container-fixed",children:e.jsxs("table",{className:"table align-middle mb-0",children:[e.jsx("thead",{className:"table-dark",style:{backgroundColor:"#212529",color:"#fff"},children:e.jsxs("tr",{children:[e.jsx("th",{className:"ps-4 py-3 fw-bold",children:"Cliente"}),e.jsx("th",{className:"py-3 fw-bold",children:"Documento"}),e.jsx("th",{className:"py-3 fw-bold",children:"Contacto"}),e.jsx("th",{className:"text-end py-3 fw-bold",style:{minWidth:"150px"},children:"Saldo Actual"}),e.jsx("th",{className:"text-center py-3 fw-bold",children:"Estado"}),e.jsx("th",{className:"text-end pe-4 py-3 fw-bold",children:"Acciones"})]})}),e.jsx("tbody",{children:f?e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"text-center py-5",children:e.jsx("div",{className:"spinner-border text-primary",role:"status"})})}):m.length===0?e.jsx("td",{colSpan:"6",className:"py-5",children:e.jsx(k,{icon:F,title:"No hay clientes",description:"No se encontraron clientes en cuenta corriente.",iconColor:"text-blue-500",bgIconColor:"bg-blue-50"})}):m.map(s=>{const t=parseFloat(s.saldo_actual||0),n=t>0,l=t<0;return e.jsxs("tr",{className:"border-bottom-0 hover-bg-light",children:[e.jsxs("td",{className:"ps-4 py-3",children:[e.jsxs("div",{className:"fw-medium text-dark",children:[s.nombre," ",s.apellido]}),e.jsx("div",{className:"small text-muted",children:s.direccion||"Sin dirección"})]}),e.jsx("td",{className:"py-3 font-monospace text-secondary",children:s.dni||s.cuit||"-"}),e.jsx("td",{className:"py-3 text-muted small",children:s.telefono||"-"}),e.jsx("td",{className:`text-end py-3 fw-bold ${n?"text-danger":l?"text-success":"text-secondary"}`,style:{fontSize:"1.1rem"},children:S(t)}),e.jsx("td",{className:"text-center py-3",children:n?e.jsx("span",{className:"badge bg-danger-subtle text-danger border border-danger px-3 py-2 rounded-pill",children:"Deudor"}):l?e.jsx("span",{className:"badge bg-success-subtle text-success border border-success px-3 py-2 rounded-pill",children:"A Favor"}):e.jsx("span",{className:"badge bg-success-subtle text-success border border-success px-3 py-2 rounded-pill",children:"Al Día"})}),e.jsx("td",{className:"text-end pe-4 py-3",children:e.jsx(q,{onClick:()=>w(s)})})]},s.id)})})]})}),e.jsx(D,{currentPage:d,totalPages:N,totalItems:v,itemsPerPage:c,onPageChange:o,onItemsPerPageChange:s=>{x(s),o(1),localStorage.setItem(i,s)}})]})})]})};export{B as default};
