import{d as G,u as L,r as a,e as _,j as e,f as W,C as P,P as J,F as p,D as C,T as K,g as Q}from"./main-894sBBaN.js";const Y=()=>{const{id:o}=G(),c=L(),[l,S]=a.useState(null),[g,T]=a.useState([]),[i,E]=a.useState([]),[F,f]=a.useState(!0),[d,j]=a.useState(""),[x,N]=a.useState(""),[h,v]=a.useState(""),[M,b]=a.useState(!1),[A,U]=a.useState(!1),[u,w]=a.useState(1),[n,$]=a.useState(10),[I,O]=a.useState(1),[y,q]=a.useState([]);a.useEffect(()=>{k()},[o]),a.useEffect(()=>{const t=i.length;O(Math.ceil(t/n));const s=(u-1)*n,r=s+n;q(i.slice(s,r))},[i,u,n]),a.useEffect(()=>{z()},[g,d,x,h]);const k=async()=>{f(!0);try{const t=await _.get(`/api/ctacte/clientes/${o}/movimientos/`);console.log("API Response:",t.data),t.data.ok&&(S(t.data.cliente),T(t.data.movimientos))}catch(t){console.error("Error al cargar movimientos:",t)}finally{f(!1)}},z=()=>{let t=[...g];d&&(t=t.filter(s=>s.fecha.split("/").reverse().join("-")>=d)),x&&(t=t.filter(s=>s.fecha.split("/").reverse().join("-")<=x)),h&&(t=t.filter(s=>s.tipo===h)),E(t)},D=()=>{j(""),N(""),v("")},R=t=>{const s=`/ctas-corrientes/clientes/${o}`;switch(t.comprobante_tipo){case"venta":c(`/ventas/${t.comprobante_id}`,{state:{from:s}});break;case"nota_credito":c(`/comprobantes/nc/${t.comprobante_id}`,{state:{from:s}});break;case"nota_debito":c(`/comprobantes/nd/${t.comprobante_id}`,{state:{from:s}});break;default:console.log("Tipo de comprobante no soportado:",t.comprobante_tipo)}},B=()=>{window.open(`/ctacte/clientes/${o}/imprimir/`,"_blank")},H=async t=>{try{const s=await _.post(`/api/ctacte/clientes/${o}/registrar-pago/`,{monto:t.monto,fecha:t.fecha,metodo_pago:t.metodo_pago,descripcion:t.descripcion,referencia:t.referencia,cheque_banco:t.cheque?.bank,cheque_numero:t.cheque?.number,cheque_fecha_emision:t.cheque?.emissionDate,cheque_fecha_pago:t.cheque?.paymentDate,cheque_firmante:t.cheque?.signer,tarjeta_last4:t.tarjeta?.last4,tarjeta_cuotas:t.tarjeta?.installments});s.data.ok?(b(!1),k()):alert("Error: "+(s.data.error||"No se pudo registrar el pago"))}catch(s){console.error("Error al registrar pago:",s),alert("Error al registrar el pago")}},m=t=>new Intl.NumberFormat("es-AR",{style:"currency",currency:"ARS"}).format(t),V=t=>{const r={VENTA:{color:"danger",text:"Venta"},PAGO:{color:"success",text:"Pago"},NOTA_CREDITO:{color:"info",text:"N/C"},NOTA_DEBITO:{color:"warning",text:"N/D"}}[t]||{color:"secondary",text:t};return e.jsx("span",{className:`badge bg-${r.color}-subtle text-${r.color} border border-${r.color} px-3 py-2 rounded-pill`,children:r.text})};return F?e.jsx("div",{className:"container-fluid px-4 pt-4 pb-3 bg-light fade-in",children:e.jsx("div",{className:"text-center py-5",children:e.jsx("div",{className:"spinner-border text-primary",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Cargando..."})})})}):e.jsxs("div",{className:"p-6 pb-10 max-w-7xl mx-auto min-h-[calc(100vh-120px)] flex flex-col fade-in",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-6 flex-1 min-h-0",children:[e.jsxs("div",{className:"lg:col-span-4 flex flex-col gap-3 overflow-y-auto pr-1",children:[e.jsxs("div",{className:"mb-6 flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(W,{onClick:()=>c("/ctas-corrientes/clientes")}),e.jsxs("h1",{className:"text-3xl font-extrabold text-slate-800 tracking-tight flex items-center gap-2",children:[e.jsx(P,{className:"text-blue-600",size:32,strokeWidth:2.5}),"Historial Cta. Cte."]})]}),e.jsxs("p",{className:"text-slate-500 font-medium ml-14 mt-1",children:["Movimientos de ",l?.nombre]})]}),e.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 shadow-sm p-4 flex flex-col gap-3 flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-blue-50 text-blue-600 flex items-center justify-center border border-blue-100 shadow-sm",children:e.jsx(P,{size:20})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-slate-800 text-base leading-tight",children:l?.nombre}),e.jsxs("p",{className:"text-[10px] text-slate-400 font-mono",children:["ID: #",l?.id]})]})]}),e.jsxs("div",{className:"p-3 bg-slate-50 rounded-xl border border-slate-100 text-center",children:[e.jsx("p",{className:"text-slate-500 text-[10px] font-bold uppercase tracking-wider mb-0.5",children:"Saldo Actual"}),e.jsx("h2",{className:`text-3xl font-black tracking-tight ${l?.saldo_actual>0?"text-red-600":l?.saldo_actual<0?"text-emerald-600":"text-slate-400"}`,children:m(l?.saldo_actual||0)}),e.jsxs("div",{className:"mt-1 text-[10px] font-bold uppercase",children:[l?.saldo_actual>0&&e.jsx("span",{className:"text-red-500 bg-red-50 px-2 py-0.5 rounded",children:"Deudor"}),l?.saldo_actual<0&&e.jsx("span",{className:"text-emerald-500 bg-emerald-50 px-2 py-0.5 rounded",children:"A Favor"}),l?.saldo_actual===0&&e.jsx("span",{className:"text-slate-500 bg-slate-100 px-2 py-0.5 rounded",children:"Al Día"})]})]}),e.jsxs("button",{onClick:()=>b(!0),className:"w-full py-2.5 bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-xl shadow-md shadow-blue-200 transition-all flex items-center justify-center gap-2 text-sm",children:[e.jsx(J,{size:18,strokeWidth:3}),"Registrar Pago"]})]}),e.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 shadow-sm p-4 flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("div",{className:"p-1.5 bg-slate-100 text-slate-600 rounded-lg",children:e.jsx(p,{size:16})}),e.jsx("h2",{className:"font-bold text-slate-700 text-sm",children:"Filtros"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-bold text-slate-500 mb-1",children:"Desde"}),e.jsx("input",{type:"date",className:"w-full px-2 py-1.5 border border-slate-200 rounded-lg text-xs focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20 bg-slate-50 text-slate-700",value:d,onChange:t=>j(t.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-bold text-slate-500 mb-1",children:"Hasta"}),e.jsx("input",{type:"date",className:"w-full px-2 py-1.5 border border-slate-200 rounded-lg text-xs focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20 bg-slate-50 text-slate-700",value:x,onChange:t=>N(t.target.value)})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-bold text-slate-500 mb-1",children:"Tipo Movimiento"}),e.jsxs("select",{className:"w-full px-2 py-1.5 border border-slate-200 rounded-lg text-xs focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20 bg-slate-50 text-slate-700",value:h,onChange:t=>v(t.target.value),children:[e.jsx("option",{value:"",children:"Todos"}),e.jsx("option",{value:"VENTA",children:"Ventas"}),e.jsx("option",{value:"PAGO",children:"Pagos"}),e.jsx("option",{value:"NOTA_CREDITO",children:"Notas de Crédito"}),e.jsx("option",{value:"NOTA_DEBITO",children:"Notas de Débito"})]})]}),e.jsx("button",{onClick:D,className:"w-full py-1.5 text-xs text-slate-500 border border-slate-200 rounded-lg hover:bg-slate-50 hover:text-slate-700 transition-colors font-medium",children:"Limpiar Filtros"})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 shadow-sm p-3 flex gap-2",children:[e.jsxs("button",{onClick:()=>window.open(`/api/ctacte/clientes/${o}/exportar/excel/`,"_blank"),className:"flex-1 py-1.5 bg-emerald-50 text-emerald-700 font-bold text-[10px] rounded-lg border border-emerald-100 hover:bg-emerald-100 transition-colors flex flex-col items-center gap-0.5",children:[e.jsx(C,{size:14})," Excel"]}),e.jsxs("button",{onClick:()=>window.open(`/api/ctacte/clientes/${o}/exportar/pdf/`,"_blank"),className:"flex-1 py-1.5 bg-red-50 text-red-700 font-bold text-[10px] rounded-lg border border-red-100 hover:bg-red-100 transition-colors flex flex-col items-center gap-0.5",children:[e.jsx(p,{size:14})," PDF"]}),e.jsxs("button",{onClick:B,className:"flex-1 py-1.5 bg-slate-50 text-slate-700 font-bold text-[10px] rounded-lg border border-slate-200 hover:bg-slate-100 transition-colors flex flex-col items-center gap-0.5",children:[e.jsx(C,{size:14})," Imprimir"]})]})]}),e.jsx("div",{className:"lg:col-span-8 flex flex-col min-h-0",children:e.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 shadow-sm flex flex-col flex-1 min-h-0 overflow-hidden relative",children:[e.jsxs("div",{className:"p-4 bg-slate-50/50 border-b border-slate-100 flex items-center justify-between flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-1.5 bg-blue-50 text-blue-600 rounded-lg",children:e.jsx(p,{size:18})}),e.jsx("h2",{className:"font-bold text-slate-700",children:"Movimientos"})]}),e.jsxs("span",{className:"text-xs font-medium text-slate-400 bg-slate-100 px-2 py-1 rounded-full",children:[i.length," Registros"]})]}),e.jsx("div",{className:"flex-1 overflow-auto",children:e.jsxs("table",{className:"w-full text-sm item-table",children:[e.jsx("thead",{className:"bg-slate-50 sticky top-0 z-10 shadow-sm text-xs font-semibold uppercase text-slate-500 tracking-wider",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left w-32",children:"Fecha"}),e.jsx("th",{className:"px-6 py-3 text-center w-24",children:"Tipo"}),e.jsx("th",{className:"px-6 py-3 text-left",children:"Descripción"}),e.jsx("th",{className:"px-6 py-3 text-right w-28",children:"Debe"}),e.jsx("th",{className:"px-6 py-3 text-right w-28",children:"Haber"}),e.jsx("th",{className:"px-6 py-3 text-right w-32",children:"Saldo"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100 bg-white",children:y.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"text-center py-10",children:e.jsxs("div",{className:"flex flex-col items-center justify-center text-slate-300",children:[e.jsx(p,{size:48,className:"mb-4 text-slate-100"}),e.jsx("p",{className:"text-slate-400 font-medium",children:"No hay movimientos registrados"})]})})}):y.map(t=>e.jsxs("tr",{className:"hover:bg-blue-50/30 transition-colors group",children:[e.jsx("td",{className:"px-6 py-3 font-mono text-xs text-slate-500 font-medium",children:t.fecha}),e.jsx("td",{className:"px-6 py-3 text-center",children:V(t.tipo)}),e.jsx("td",{className:"px-6 py-3",children:e.jsx("span",{className:"text-blue-600 font-medium hover:underline cursor-pointer",onClick:()=>R(t),children:t.descripcion})}),e.jsx("td",{className:"px-6 py-3 text-right font-medium text-red-500",children:t.debe>0?m(t.debe):"-"}),e.jsx("td",{className:"px-6 py-3 text-right font-medium text-emerald-600",children:t.haber>0?m(t.haber):"-"}),e.jsx("td",{className:`px-6 py-3 text-right font-bold ${t.saldo>0?"text-red-500":t.saldo<0?"text-emerald-600":"text-slate-400"}`,children:m(t.saldo)})]},t.id))})]})}),e.jsx("div",{className:"border-t border-slate-100 p-2 bg-white",children:e.jsx(K,{currentPage:u,totalPages:I,totalItems:i.length,itemsPerPage:n,onPageChange:w,onItemsPerPageChange:t=>{$(t),w(1)}})})]})})]}),e.jsx(Q,{isOpen:M,onClose:()=>b(!1),onConfirm:H,total:l?.saldo_actual||0,mode:"payment",clientName:l?.nombre,isSaving:A})]})};export{Y as default};
