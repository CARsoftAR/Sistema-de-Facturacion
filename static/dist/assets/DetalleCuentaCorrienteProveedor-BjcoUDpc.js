import{d as W,u as V,r as a,e as C,j as e,f as J,h as _,P as K,F as h,D as S,T as Q,g as U}from"./main-894sBBaN.js";const Y=()=>{const{id:o}=W(),u=V(),[l,M]=a.useState(null),[g,F]=a.useState([]),[i,T]=a.useState([]),[A,f]=a.useState(!0),[c,j]=a.useState(""),[n,N]=a.useState(""),[x,v]=a.useState(""),[E,b]=a.useState(!1),[R,y]=a.useState(!1),[p,w]=a.useState(1),[d,q]=a.useState(10),[z,I]=a.useState(1),[P,$]=a.useState([]);a.useEffect(()=>{k()},[o]),a.useEffect(()=>{const s=i.length;I(Math.ceil(s/d));const t=(p-1)*d,r=t+d;$(i.slice(t,r))},[i,p,d]),a.useEffect(()=>{D()},[g,c,n,x]);const k=async()=>{f(!0);try{const s=await C.get(`/api/ctacte/proveedores/${o}/movimientos/`);console.log("API Response:",s.data),s.data.ok&&(M(s.data.proveedor),F(s.data.movimientos))}catch(s){console.error("Error al cargar movimientos:",s)}finally{f(!1)}},D=()=>{let s=[...g];c&&(s=s.filter(t=>t.fecha.split("/").reverse().join("-")>=c)),n&&(s=s.filter(t=>t.fecha.split("/").reverse().join("-")<=n)),x&&(s=s.filter(t=>t.tipo===x)),T(s)},O=()=>{j(""),N(""),v("")},H=s=>{const t=`/ctas-corrientes/proveedores/${o}`;switch(s.comprobante_tipo){case"compra":u(`/compras/${s.comprobante_id}`,{state:{from:t}});break;case"pago":break;default:console.log("Tipo de comprobante no soportado para detalle:",s.comprobante_tipo)}},B=()=>{window.open(`/ctacte/proveedores/${o}/imprimir/`,"_blank")},G=async s=>{y(!0);try{const t=await C.post(`/api/ctacte/proveedores/${o}/registrar-pago/`,{monto:s.monto,fecha:s.fecha,metodo_pago:s.metodo_pago,descripcion:s.descripcion,referencia:s.referencia,cheque_banco:s.cheque?.bank,cheque_numero:s.cheque?.number,cheque_fecha_emision:s.cheque?.emissionDate,cheque_fecha_pago:s.cheque?.paymentDate,cheque_firmante:s.cheque?.signer});t.data.ok?(b(!1),k()):alert("Error: "+(t.data.error||"No se pudo registrar el pago"))}catch(t){console.error("Error al registrar pago:",t),alert("Error al registrar el pago")}finally{y(!1)}},m=s=>new Intl.NumberFormat("es-AR",{style:"currency",currency:"ARS"}).format(s),L=s=>{const r={COMPRA:{color:"danger",text:"Compra"},PAGO:{color:"success",text:"Pago"},NOTA_CREDITO:{color:"info",text:"N/C"},NOTA_DEBITO:{color:"warning",text:"N/D"}}[s]||{color:"secondary",text:s};return e.jsx("span",{className:`badge bg-${r.color}-subtle text-${r.color} border border-${r.color} px-3 py-2 rounded-pill`,children:r.text})};return A?e.jsx("div",{className:"container-fluid px-4 pt-4 pb-3 bg-light fade-in",children:e.jsx("div",{className:"text-center py-5",children:e.jsx("div",{className:"spinner-border text-primary",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Cargando..."})})})}):e.jsxs("div",{className:"p-6 pb-10 max-w-7xl mx-auto min-h-[calc(100vh-120px)] flex flex-col fade-in",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-6 flex-1 min-h-0",children:[e.jsxs("div",{className:"lg:col-span-4 flex flex-col gap-3 overflow-y-auto pr-1",children:[e.jsxs("div",{className:"mb-6 flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(J,{onClick:()=>u("/ctas-corrientes/proveedores")}),e.jsxs("h1",{className:"text-3xl font-extrabold text-slate-800 tracking-tight flex items-center gap-2",children:[e.jsx(_,{className:"text-blue-600",size:32,strokeWidth:2.5}),"Historial Cta. Cte."]})]}),e.jsxs("p",{className:"text-slate-500 font-medium ml-14 mt-1",children:["Movimientos de ",l?.nombre]})]}),e.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 shadow-sm p-4 flex flex-col gap-3 flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-blue-50 text-blue-600 flex items-center justify-center border border-blue-100 shadow-sm",children:e.jsx(_,{size:20})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-slate-800 text-base leading-tight",children:l?.nombre}),e.jsxs("p",{className:"text-[10px] text-slate-400 font-mono",children:["ID: #",l?.id]})]})]}),e.jsxs("div",{className:"p-3 bg-slate-50 rounded-xl border border-slate-100 text-center",children:[e.jsx("p",{className:"text-slate-500 text-xs font-bold uppercase tracking-wider mb-0.5",children:"Saldo Actual"}),e.jsx("h2",{className:`text-3xl font-black tracking-tight ${l?.saldo_actual>0?"text-red-600":l?.saldo_actual<0?"text-emerald-600":"text-slate-400"}`,children:m(l?.saldo_actual||0)}),e.jsxs("div",{className:"mt-1 text-xs font-bold uppercase",children:[l?.saldo_actual>0&&e.jsx("span",{className:"text-red-500 bg-red-50 px-2 py-0.5 rounded",children:"Deuda Pendiente"}),l?.saldo_actual<0&&e.jsx("span",{className:"text-emerald-500 bg-emerald-50 px-2 py-0.5 rounded",children:"A Favor"}),l?.saldo_actual===0&&e.jsx("span",{className:"text-slate-500 bg-slate-100 px-2 py-0.5 rounded",children:"Al Día"})]})]}),e.jsxs("button",{onClick:()=>b(!0),className:"w-full py-2.5 bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-xl shadow-md shadow-blue-200 transition-all flex items-center justify-center gap-2 text-sm",children:[e.jsx(K,{size:18,strokeWidth:3}),"Registrar Pago"]})]}),e.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 shadow-sm p-4 flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("div",{className:"p-1.5 bg-slate-100 text-slate-600 rounded-lg",children:e.jsx(h,{size:16})}),e.jsx("h2",{className:"font-bold text-slate-700 text-lg",children:"Filtros"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 mb-1",children:"Desde"}),e.jsx("input",{type:"date",className:"w-full px-2 py-1.5 border border-slate-200 rounded-lg text-sm focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20 bg-slate-50 text-slate-700",value:c,onChange:s=>j(s.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 mb-1",children:"Hasta"}),e.jsx("input",{type:"date",className:"w-full px-2 py-1.5 border border-slate-200 rounded-lg text-sm focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20 bg-slate-50 text-slate-700",value:n,onChange:s=>N(s.target.value)})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 mb-1",children:"Tipo Movimiento"}),e.jsxs("select",{className:"w-full px-2 py-1.5 border border-slate-200 rounded-lg text-sm focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20 bg-slate-50 text-slate-700",value:x,onChange:s=>v(s.target.value),children:[e.jsx("option",{value:"",children:"Todos"}),e.jsx("option",{value:"COMPRA",children:"Compras"}),e.jsx("option",{value:"PAGO",children:"Pagos"})]})]}),e.jsx("button",{onClick:O,className:"w-full py-1.5 text-sm text-slate-500 border border-slate-200 rounded-lg hover:bg-slate-50 hover:text-slate-700 transition-colors font-medium",children:"Limpiar Filtros"})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 shadow-sm p-3 flex gap-2",children:[e.jsxs("button",{disabled:!0,className:"flex-1 py-1.5 bg-emerald-50 text-emerald-400 font-bold text-xs rounded-lg border border-emerald-100 flex flex-col items-center gap-0.5 opacity-50 cursor-not-allowed",children:[e.jsx(S,{size:14})," Excel"]}),e.jsxs("button",{disabled:!0,className:"flex-1 py-1.5 bg-red-50 text-red-400 font-bold text-xs rounded-lg border border-red-100 flex flex-col items-center gap-0.5 opacity-50 cursor-not-allowed",children:[e.jsx(h,{size:14})," PDF"]}),e.jsxs("button",{onClick:B,className:"flex-1 py-1.5 bg-slate-50 text-slate-700 font-bold text-xs rounded-lg border border-slate-200 hover:bg-slate-100 transition-colors flex flex-col items-center gap-0.5",children:[e.jsx(S,{size:14})," Imprimir"]})]})]}),e.jsx("div",{className:"lg:col-span-8 flex flex-col min-h-0",children:e.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 shadow-sm flex flex-col flex-1 min-h-0 overflow-hidden relative",children:[e.jsxs("div",{className:"p-4 bg-slate-50/50 border-b border-slate-100 flex items-center justify-between flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-1.5 bg-blue-50 text-blue-600 rounded-lg",children:e.jsx(h,{size:18})}),e.jsx("h2",{className:"font-bold text-slate-700",children:"Movimientos"})]}),e.jsxs("span",{className:"text-xs font-medium text-slate-400 bg-slate-100 px-2 py-1 rounded-full",children:[i.length," Registros"]})]}),e.jsx("div",{className:"flex-1 overflow-auto",children:e.jsxs("table",{className:"w-full text-sm item-table",children:[e.jsx("thead",{className:"bg-[#212529] text-white sticky top-0 z-10 shadow-sm text-sm font-semibold tracking-wide",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left w-32 border-b border-slate-700",children:"Fecha"}),e.jsx("th",{className:"px-6 py-3 text-center w-24 border-b border-slate-700",children:"Tipo"}),e.jsx("th",{className:"px-6 py-3 text-left border-b border-slate-700",children:"Descripción"}),e.jsx("th",{className:"px-6 py-3 text-right w-28 border-b border-slate-700",children:"Debe"}),e.jsx("th",{className:"px-6 py-3 text-right w-28 border-b border-slate-700",children:"Haber"}),e.jsx("th",{className:"px-6 py-3 text-right w-32 border-b border-slate-700",children:"Saldo"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100 bg-white",children:P.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"text-center py-10",children:e.jsxs("div",{className:"flex flex-col items-center justify-center text-slate-300",children:[e.jsx(h,{size:48,className:"mb-4 text-slate-100"}),e.jsx("p",{className:"text-slate-400 font-medium",children:"No hay movimientos registrados"})]})})}):P.map(s=>e.jsxs("tr",{className:"hover:bg-blue-50/30 transition-colors group",children:[e.jsx("td",{className:"px-6 py-2.5 font-mono text-xs text-slate-500 font-medium",children:s.fecha}),e.jsx("td",{className:"px-6 py-2.5 text-center",children:L(s.tipo)}),e.jsx("td",{className:"px-6 py-2.5",children:e.jsx("span",{className:"text-blue-600 font-medium hover:underline cursor-pointer",onClick:()=>H(s),children:s.descripcion})}),e.jsx("td",{className:"px-6 py-2.5 text-right font-medium text-emerald-600",children:s.debe>0?m(s.debe):"-"}),e.jsx("td",{className:"px-6 py-2.5 text-right font-medium text-red-500",children:s.haber>0?m(s.haber):"-"}),e.jsx("td",{className:`px-6 py-2.5 text-right font-bold ${s.saldo>0?"text-red-500":s.saldo<0?"text-emerald-600":"text-slate-400"}`,children:m(s.saldo)})]},s.id))})]})}),e.jsx("div",{className:"border-t border-slate-100 p-2 bg-white",children:e.jsx(Q,{currentPage:p,totalPages:z,totalItems:i.length,itemsPerPage:d,onPageChange:w,onItemsPerPageChange:s=>{q(s),w(1)}})})]})})]}),e.jsx(U,{isOpen:E,onClose:()=>b(!1),onConfirm:G,total:l?.saldo_actual||0,mode:"payment",clientName:l?.nombre,isSaving:R,title:"Registrar Pago a Proveedor"})]})};export{Y as default};
